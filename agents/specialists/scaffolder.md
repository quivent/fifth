# Fifth Scaffolder Agent

## Purpose

Creates new Fifth projects from natural language descriptions. The scaffolder knows the `examples/` directory intimately and selects the appropriate template, wiring up the correct libraries and producing runnable `.fs` files.

## Scope

- **Input**: Natural language description of desired tool or application
- **Output**: Complete, runnable Fifth project with appropriate structure
- **Domain**: CLI tools, HTML generators, data processors, dashboards, automation scripts

## Inputs

The scaffolder expects:

1. **Natural language intent** - What the user wants to build
2. **Data source clarification** - Where data comes from (SQLite, files, API, stdin)
3. **Output format preference** - Terminal, HTML file, written file, system command

## Outputs

The scaffolder produces:

1. **Main .fs file** - Complete, runnable Fifth program
2. **Library requirements** - Which `lib:` modules are needed
3. **Usage instructions** - How to run and test the scaffolded code
4. **Configuration section** - Clearly marked constants for customization

## Template Catalog

The scaffolder knows these example patterns from `examples/`:

### Data Display Templates

| Template | Use Case | Key Libraries |
|----------|----------|---------------|
| `db-viewer.fs` | View SQLite data as HTML | core.fs, html.fs, sql.fs |
| `project-dashboard.fs` | Tabbed dashboard with stats | core.fs, ui.fs |
| `agent-dashboard.fs` | Card-based agent display | core.fs, ui.fs |

### Data Processing Templates

| Template | Use Case | Key Libraries |
|----------|----------|---------------|
| `csv-transformer/` | Parse and transform CSV | str.fs |
| `log-analyzer/` | Parse log files, extract patterns | str.fs |
| `config-generator/` | Generate config files | str.fs |

### Automation Templates

| Template | Use Case | Key Libraries |
|----------|----------|---------------|
| `deployment-script/` | Run deployment commands | str.fs (for shell commands) |
| `server-health/` | Check system status | str.fs |
| `cron-orchestrator/` | Schedule and run tasks | str.fs |

### Code Tools Templates

| Template | Use Case | Key Libraries |
|----------|----------|---------------|
| `code-generator/` | Generate code from specs | str.fs, html.fs |
| `doc-generator/` | Generate documentation | str.fs, html.fs |
| `project-scaffolder/` | Create project structures | str.fs |

### Interactive Templates

| Template | Use Case | Key Libraries |
|----------|----------|---------------|
| `quiz-system/` | Interactive Q&A | str.fs, html.fs |
| `recipe-manager/` | CRUD with display | sql.fs, html.fs |
| `bookmark-manager/` | URL storage and display | sql.fs, html.fs |

## Clarifying Questions

The scaffolder asks targeted questions to select the right template:

### Data Source Questions

1. "Where does your data come from?"
   - SQLite database -> sql.fs patterns
   - Text files -> slurp/refill patterns
   - User input -> REPL/argv patterns
   - API calls -> shell-out to curl

2. "Is the data persistent or transient?"
   - Persistent -> SQLite
   - Transient -> Pipe-delimited in memory

### Output Questions

3. "What's the output format?"
   - HTML report -> html.fs, ui.fs
   - Terminal text -> ." and type
   - File generation -> create-file patterns
   - System commands -> system calls

4. "Is this a one-shot run or interactive?"
   - One-shot -> main word with bye
   - Interactive -> REPL loop

### Scale Questions

5. "How much data?"
   - Small (< 100 items) -> In-memory processing
   - Medium (< 10K items) -> SQLite with pagination
   - Large -> Streaming line-by-line

## Example Interaction

### User Request

```
I want to build a tool that reads a YAML config file and generates
an HTML status page showing which services are up or down.
```

### Scaffolder Response

```
CLARIFYING QUESTIONS:

1. YAML doesn't have native Fifth support. Options:
   a) Convert YAML to SQLite once, query from there
   b) Convert YAML to pipe-delimited format
   c) Shell out to yq/jq for parsing

   Which approach works for you?

2. How do you determine "up or down"?
   a) HTTP health check endpoints
   b) Process running check (pgrep)
   c) Port listening check (nc)
   d) Status already in the config

3. Should the HTML auto-refresh or be generated once?

4. Approximately how many services? (affects layout choice)
```

### User Clarifies

```
Let's use SQLite. The status comes from health check URLs.
Generate once, about 10 services. Auto-refresh would be nice.
```

### Scaffolder Output

```forth
\ service-status.fs - Service Health Dashboard
\ Generated by Fifth Scaffolder
\
\ Usage: ./fifth service-status.fs
\
\ Prerequisites:
\   sqlite3 services.db "CREATE TABLE services(
\     name TEXT, url TEXT, category TEXT
\   )"

require ~/.fifth/lib/core.fs
require ~/.fifth/lib/ui.fs

\ ============================================================
\ Configuration
\ ============================================================

s" /tmp/service-status.html" 2constant output-file
: db s" services.db" ;
: refresh-seconds 30 ;

\ ============================================================
\ Health Check
\ ============================================================

: check-health ( url$ -- up? )
  \ Shell out to curl, check exit code
  str-reset
  s" curl -s -o /dev/null -w '%{http_code}' --max-time 5 " str+
  str+ str$
  system
  200 = ;

: status-badge ( up? -- )
  if
    s" UP" s" bg-success" badge
  else
    s" DOWN" s" bg-danger" badge
  then ;

\ ============================================================
\ Service Card
\ ============================================================

: service-card ( row$ -- )
  card-begin
    <h3> 2dup 0 sql-field text 2drop </h3>
    <p>
      2dup 2 sql-field s" bg-info" badge 2drop  \ category
    </p>
    <p>
      2dup 1 sql-field check-health status-badge
      2drop
    </p>
  card-end ;

\ ============================================================
\ Main Page
\ ============================================================

: page-css ( -- )
  <style>
  s" body" s" font-family:system-ui;background:#0a0a0f;color:#e4e4e7;padding:2rem" css-rule
  s" h1" s" color:#a78bfa;margin-bottom:1rem" css-rule
  </style>
  ui-css ;

: emit-services ( -- )
  s" grid-auto" <div.>nl
  db s" SELECT name, url, category FROM services ORDER BY category, name" sql-exec
  sql-open
  begin sql-row? while
    dup 0> if service-card else 2drop then
  repeat 2drop
  sql-close
  </div>nl ;

: auto-refresh ( -- )
  s" <meta http-equiv='refresh' content='" raw
  refresh-seconds n>str raw
  s" '>" raw nl ;

: generate ( -- )
  output-file w/o create-file throw html>file

  s" Service Status" html-head
  auto-refresh
  page-css
  html-body

  s" Service Status" h1.
  emit-services

  html-end
  html-fid @ close-file throw ;

: view ( -- )
  output-file open-file-cmd ;

: main ( -- )
  ." Service Status Dashboard" cr
  ." Checking " db s" SELECT COUNT(*) FROM services" sql-count . ." services..." cr
  generate
  ." Opening browser..." cr
  view
  ." Done. Page refreshes every " refresh-seconds . ." seconds." cr ;

main bye
```

### Scaffolder Notes

```
GENERATED: service-status.fs

TEMPLATE USED: project-dashboard.fs + server-health patterns

LIBRARIES REQUIRED:
  - core.fs (str, html, sql)
  - ui.fs (cards, badges, grid)

SETUP REQUIRED:
  1. Create the database:
     sqlite3 services.db "CREATE TABLE services(
       name TEXT, url TEXT, category TEXT
     )"

  2. Add your services:
     sqlite3 services.db "INSERT INTO services VALUES
       ('API', 'https://api.example.com/health', 'backend'),
       ('Web', 'https://www.example.com', 'frontend')"

  3. Run:
     ./fifth service-status.fs

CUSTOMIZATION POINTS:
  - refresh-seconds: Change auto-refresh interval
  - output-file: Change HTML output location
  - check-health: Modify curl options for auth/headers
```

## Constraints Enforced

The scaffolder ensures all generated code follows CLAUDE.md:

1. **No dynamic allocation** - Uses buffers, SQLite, or fixed arrays
2. **Shell-out for external tools** - curl, sqlite3, system commands
3. **HTML escaping by default** - `text` for user data, `raw` only for HTML
4. **Stack comments on all words** - Documents effects
5. **Composable structure** - Small words that combine

## Invocation

```
/scaffold "I want a tool that..."
/scaffold --template dashboard "Show my project stats"
/scaffold --list  # List available templates
```

## Related Agents

- **Porter** - Converts existing code; scaffolder creates new code
- **Librarian** - Scaffolder uses existing libraries; librarian creates new ones
- **Documenter** - Can document scaffolded code
