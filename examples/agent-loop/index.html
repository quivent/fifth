<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Loop — Fifth</title>
  <link rel="icon" type="image/svg+xml" href="../../brand/favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
  <style>:root{--black:#0a0a0a;--gray-950:#0f0f0f;--gray-900:#171717;--gray-800:#262626;--gray-700:#404040;--gray-500:#737373;--gray-400:#a3a3a3;--gray-100:#f5f5f5;--accent:#6366f1;--font-sans:'Inter',system-ui,sans-serif;--font-mono:'JetBrains Mono',monospace}*{box-sizing:border-box;margin:0;padding:0}body{font-family:var(--font-sans);background:var(--black);color:var(--gray-100);line-height:1.7}.nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:1rem 1.5rem;background:rgba(10,10,10,.8);backdrop-filter:blur(12px);border-bottom:1px solid var(--gray-900);display:flex;align-items:center;justify-content:space-between}.nav-brand{display:flex;align-items:center;gap:.75rem;text-decoration:none;color:var(--gray-100)}.nav-brand svg{width:24px;height:24px}.nav-brand span{font-weight:600}.nav-back{font-size:.875rem;color:var(--gray-400);text-decoration:none;display:flex;align-items:center;gap:.5rem}.nav-back:hover{color:var(--gray-100)}.container{max-width:800px;margin:0 auto;padding:8rem 1.5rem 4rem}.badge{display:inline-block;padding:.25rem .75rem;background:var(--gray-900);border:1px solid var(--gray-800);border-radius:100px;font-size:.75rem;color:var(--gray-400);text-transform:uppercase;letter-spacing:.05em;margin-bottom:1.5rem}h1{font-size:2.5rem;font-weight:600;letter-spacing:-.03em;margin-bottom:1rem}.lead{font-size:1.125rem;color:var(--gray-400);margin-bottom:2.5rem;line-height:1.7}h2{font-size:.75rem;font-weight:500;text-transform:uppercase;letter-spacing:.1em;color:var(--gray-500);margin:3rem 0 1rem;padding-bottom:.75rem;border-bottom:1px solid var(--gray-800)}h3{font-size:1rem;font-weight:600;color:var(--gray-100);margin:1.5rem 0 .75rem}p{color:var(--gray-400);margin:.75rem 0}ul,ol{margin:1rem 0;padding-left:1.5rem}li{margin:.5rem 0;color:var(--gray-400)}li strong{color:var(--gray-100)}code{font-family:var(--font-mono);font-size:.875rem}p code,li code{background:var(--gray-900);padding:.125rem .375rem;border-radius:4px;font-size:.8125rem;color:var(--gray-100)}pre{background:var(--gray-950);border:1px solid var(--gray-800);border-radius:8px;padding:1.25rem;overflow-x:auto;margin:1.5rem 0;font-size:.8125rem;line-height:1.6}pre code{background:none;padding:0;color:var(--gray-100)}.run-command{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;background:var(--gray-950);border:1px solid var(--gray-800);border-radius:8px;margin:1.5rem 0}.run-command code{flex:1;color:var(--gray-100)}.run-command .hint{font-size:.75rem;color:var(--gray-500)}.feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin:1.5rem 0}.feature{padding:1.25rem;background:var(--gray-950);border:1px solid var(--gray-800);border-radius:8px}.feature strong{display:block;font-size:.875rem;font-weight:600;color:var(--gray-100);margin-bottom:.375rem}.feature span{font-size:.875rem;color:var(--gray-500)}.arch{background:var(--gray-950);border:1px solid var(--gray-800);border-radius:8px;padding:1.5rem;margin:1.5rem 0;overflow-x:auto}.arch pre{background:transparent;border:none;padding:0;margin:0;font-size:.75rem;line-height:1.5;color:var(--gray-400)}.footer{margin-top:4rem;padding-top:2rem;border-top:1px solid var(--gray-800);text-align:center}.footer a{color:var(--accent);text-decoration:none}.footer p{font-size:.875rem;color:var(--gray-500)}</style>
</head>
<body>
  <nav class="nav"><a href="../showcase/index.html" class="nav-brand"><svg viewBox="0 0 32 32" fill="none"><path d="M6 8L16 24L26 8" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 8H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.3"/></svg><span>Fifth</span></a><a href="../showcase/index.html" class="nav-back"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 12L6 8L10 4"/></svg>All Examples</a></nav>
  <main class="container">
    <div class="badge">Agentic AI</div>
    <h1>Agent Loop</h1>
    <p class="lead">Production-grade autonomous agent framework implementing the ReAct pattern. Think → Act → Observe → Repeat. Tool use, self-correction, and memory — all with explicit stack-based state flow.</p>

    <h2>Run</h2>
    <div class="run-command"><code>AGENT_TASK="Fix the bug in parser.c" fifth examples/agent-loop/main.fs</code><span class="hint">run agent</span></div>
    <div class="run-command"><code>AGENT_MODE=tools fifth examples/agent-loop/main.fs</code><span class="hint">list tools</span></div>

    <h2>The ReAct Pattern</h2>
    <div class="arch"><pre>User Task → THINK (LLM reasons) → ACT (tool call) → OBSERVE (result) → loop
                ↓                      ↓                   ↓
           build-prompt           dispatch-tool      history-add
                ↓                      ↓                   ↓
             call-llm            execute + capture    check-limits</pre></div>

    <h2>Why Forth for Agents?</h2>
    <div class="feature-grid">
      <div class="feature"><strong>Stack as State</strong><span>Agent state flows explicitly through the stack between phases</span></div>
      <div class="feature"><strong>Visible Control</strong><span>No hidden async magic — the loop is readable</span></div>
      <div class="feature"><strong>Composition</strong><span>Small words compose into complex behavior</span></div>
    </div>

    <h2>Tool System</h2>
    <p>Tools registered with name, description, and handler. Uniform interface: <code>( args$ -- result$ success? )</code></p>
    <ul>
      <li><strong>shell</strong> — Execute shell commands</li>
      <li><strong>read</strong> — Read file contents</li>
      <li><strong>write</strong> — Write to files</li>
      <li><strong>grep</strong> — Search files</li>
    </ul>

    <h2>Self-Correction</h2>
    <ul>
      <li><strong>Retry with backoff</strong> — Exponential delay on failures</li>
      <li><strong>Error recovery</strong> — Tool errors fed back to LLM for reasoning</li>
      <li><strong>Stuck detection</strong> — Detect repeated actions, inject guidance</li>
    </ul>

    <h2>Memory Management</h2>
    <p>Ring buffer history with configurable size. Context summarization when approaching token limits. Full history stored in SQLite for retrieval.</p>

    <h2>Example Session</h2>
    <pre><code>1. Think: "I need to understand the parser code first"
2. Act:   {"tool": "read", "args": {"path": "src/parser.c"}}
3. Observe: [file contents]
4. Think: "I see parse() doesn't check for NULL..."
5. Act:   {"tool": "write", "args": {"path": "src/parser.c", ...}}
6. Observe: [success]
7. Think: "Let me verify the fix"
8. Act:   {"tool": "shell", "args": {"cmd": "make test"}}
9. Done:  {"done": true, "result": "Fixed null pointer bug"}</code></pre>

    <h2>Configuration</h2>
    <ul>
      <li><code>ANTHROPIC_API_KEY</code> — Required for API calls</li>
      <li><code>AGENT_TASK</code> — The task to complete</li>
      <li><code>AGENT_MODE</code> — <code>run</code>, <code>dry</code>, or <code>tools</code></li>
    </ul>

    <div class="footer"><p>Part of <a href="../showcase/index.html">Fifth Examples</a></p></div>
  </main>
</body>
</html>
